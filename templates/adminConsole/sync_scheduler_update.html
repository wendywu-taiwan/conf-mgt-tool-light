{% extends "admin_console_base.html" %}
{% load staticfiles %}

{% block resource %}
    <link href="{% static '/css/sync_scheduler_create.css' %}" rel="stylesheet">
    <script src="{% static '/js/adminConsole/sync-scheduler-create.js' %}"></script>
    <script src="{% static '/js/adminConsole/sync-scheduler-update.js' %}"></script>
{% endblock %}

{% block content %}
    <div id="create_sync_task_container" class="custom_container admin_console_block_background">
        <div id="header_div" class="row">
            <div class="page_title_div">Ruleset Sync Task</div>
            <div id="action_button_div" class="row no_row_margin">
                <div id="create_button_div">
                    <a id="create_btn" class="btn btn-block btn-lg btn-warning" onclick="createBtnOnClick()">SAVE
                    </a>
                </div>
            </div>
        </div>

        <div id="env_group_div" class="row no_row_margin">
            <div id="source_env_select_div" class="env_select_div">
                <div class="block_title_div">From :</div>
                <div id="source_env_dropdown_div" class="btn-group env_select_dropdown_div">
                    <button id="select_source_env_btn" data-toggle="dropdown"
                            class="env_select_dropdown_btn btn btn-primary dropdown-toggle"
                            type="button"
                            aria-expanded="false">Select <span class="caret"></span></button>
                    <ul id="source_env_select_list" role="menu" class="dropdown-menu env_select_dropdown_list_ul"
                        x-placement="bottom-start"
                        style="position: absolute; transform: translate3d(0px, 41px, 0px); top: 0px; left: 0px; will-change: transform;">
                        {% for data in source_environment %}
                            <li value="{{ data.id }}">
                                <a class="env_select_dropdown_list_item_text">{{ data.name }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div id="target_env_select_div" class="env_select_div">
                <div class="block_title_div">To :</div>
                <div id="target_env_dropdown_div" class="btn-group env_select_dropdown_div">
                    <button id="select_target_env_btn" data-toggle="dropdown"
                            class="env_select_dropdown_btn btn btn-primary dropdown-toggle"
                            type="button"
                            aria-expanded="false">Select <span class="caret"></span></button>
                    <ul id="target_env_select_list" role="menu" class="dropdown-menu env_select_dropdown_list_ul"
                        x-placement="bottom-start"
                        style="position: absolute; transform: translate3d(0px, 41px, 0px); top: 0px; left: 0px; will-change: transform;">
                        {% for data in target_environment %}
                            <li value="{{ data.id }}">
                                <a class="env_select_dropdown_list_item_text">{{ data.name }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

        <div id="country_select_div">
            <div class="block_title_div">Country :</div>

            <div id="country_check_box_div" class="row no_row_margin">
                {% for data in countries %}
                    <div class="checkbox_input_div form-check form-check-inline">
                        <input onclick="countryCheckboxOnChange(this)" class="form-check-input checkbox_input"
                               type="checkbox"
                               id="checkbox_input_{{ data.id }}" value="{{ data.id }}">
                        <label class="form-check-label" for="checkbox_input_{{ data.id }}"> {{ data.full_name }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div id="action_select_div">
            <div class="block_title_div">Sync Action :</div>
            <div id="action_checkbox_div" class="row no_row_margin">
                {% for action in action_list %}
                    <div class="checkbox_input_div form-check form-check-inline">
                        <input onclick="actionCheckboxOnChanged(this)" class="form-check-input checkbox_input"
                               type="checkbox"
                               id="action_{{ action }}" value="{{ action }}">
                        <label class="option_font_size form-check-label" for="action_{{ action }}"> {{ action }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div id="time_select_group_div" class="row no_row_margin">
            <div id="select_proceed_time_div" class="time_select_div">
                <div class="block_title_div">Next Proceed Time :</div>
                <div id="clock_picker_div" class="time_input_div input-group clockpicker" data-placement="left"
                     data-align="top"
                     data-autoclose="true">
                    <input id="clock_picker_input" type="text" class="time_input form-control" placeholder="Ex. 8:00">
                    <span id="clock_picker_right_span" class="time_input_right_span input-group-addon">
                    <span id="clock_picker_icon_span" class="time_input_icon_span glyphicon fui-time"></span>
                </span>
                </div>
            </div>
            <div id="select_interval_time_div" class="time_select_div">
                <div class="block_title_div">Interval Hour :</div>
                <div id="hour_input_div" class="time_input_div input-group" data-placement="left"
                     data-align="top"
                     data-autoclose="true">
                    <input id="hour_input" type="text" class="time_input form-control" placeholder="Enter Interval..">
                    <span id="hour_input_right_span" class="time_input_right_span input-group-addon">
                        <span id="hour_input_icon_span" class="time_input_icon_span">Hour</span>
                </span>
                </div>
            </div>
        </div>

        <div id="mail_receiver_list_div">
            <div class="block_title_div">Receivers :</div>
            <div>
                <div id="mail_receiver_input_div" class="tagsinput-primary">
                    <input id="mail_receiver_input" name="tagsinput" class="tagsinput" data-role="tagsinput"
                           placeholder="enter email..."
                           style="display: none;">
                </div>
            </div>
        </div>
        <div id="backup_div">
            <div class="block_title_div">Backup Rulesets :</div>

            <div id="backup_checkbox_div" class="country_check_box_div row no_row_margin">
                <div class="checkbox_input_div form-check form-check-inline">
                    <input onclick="backupOnChecked(this)" class="form-check-input checkbox_input"
                           type="checkbox"
                           id="backup_yes_input" value="true">
                    <label class="option_font_size form-check-label" for="backup_yes_input"> Yes </label>
                </div>
            </div>
        </div>
    </div>

    <script>
        init("{{ admin_console_info.module.id }}",
            "{% url 'update-rulesets-sync-job' %}",
            "{% url 'sync-scheduler-list' %}");

        source_env_id = {{ scheduler_data.source_environment.id }};
        source_env_name = "{{ scheduler_data.source_environment.name }}";
        target_env_id = {{ scheduler_data.target_environment.id }};
        target_env_name = "{{ scheduler_data.target_environment.name }}";

        select_country_id = {{ scheduler_data.country_list.0.id }};

        setSourceEnvSelected(source_env_id, source_env_name);
        setTargetEnvSelected(target_env_id, target_env_name);
        //check country
        '{% for country in scheduler_data.country_list %}'
            setCountryChecked('{{ country.id }}');
            '{% endfor %}'

        //selected action
        '{% for action in scheduler_data.action_list %}'
            setActionChecked('{{ action }}');
            '{% endfor %}'

        //selected daily proceed time
        setDailyProceedTime('{{ scheduler_data.next_proceed_time }}');
        //select interval hour
        setIntervalHour('{{ scheduler_data.interval_hour }}');

        //add receiver
        '{% for receiver in scheduler_data.receiver_list %}'
            addReceivers('{{ receiver }}');
            '{% endfor %}'
        setReceivers();
        setBackupCheck();

        createBtnOnClick = function () {
            updateTask();
        }
    </script>
{% endblock %}